############################################################################
# About this file.
#
# This is the ini file for tvpvrd*, a unix server program, usually run as
# a daemon. The purpose of the program is to execute scheduled recordings
# from a TV capture card capable of HW assisted MP2 encoding.
#
# There are three major sections in this file, hey are:
#
# config:     General settings for the server
# encoder:    Setting for the TV Capture card HW MP2 encoder
# ffmpeg:     General setting for the ffmpeg based transcoding to .mp4 files
#             
# (*tvpvrd = TV Personal Video Recorder Daemon)
#
# --------------------------------------------------------------------------
#
# Copyright (C) 2009,2010 Johan Persson
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# any later version.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>
############################################################################

############################################################################
# config - General settings
############################################################################

[config]
#----------------------------------------------------------------------------
# MASTER boolean
# Determine if this server is to run as master or slave. A master server
# must have one or more video cards and supports the full command set.
# A slave server do not need to have a video card. Instead a slave server
# is exclusively used to transcode files.  A slave server can therefore
# be used to help the master to transcode files. For this to work well the
# slave server must have access to the masters server data catalogue.
# The slave assumes that the master data catalogue is mounted on the
# specified dirctory (see DATADIR) this should point to the same
# directyory as DATADIR on the master but as seen from the slave, 
# for example /mnt/master/data/pvr or similar if a NFS file mount is used
# on the slave to view the master file system
#----------------------------------------------------------------------------
master=yes

#----------------------------------------------------------------------------
# PORT integer
# Default TCP/IP port where the server will listen for incoming connections
# The port number must be unique for this server. If any other applications
# currently running is using this port an error message will be printed
# during server startup and the server will be terminated.
#----------------------------------------------------------------------------
port=9300

#----------------------------------------------------------------------------
# ENABLE_WEBINTERFACE boolean
# Should we allow connections to the (very) primitive WEB-interface
# available on port (port+1), i.e. 9301 with the default settings.
# As of now the interface only allows non interactive, non modifying
# commands like status, and various list commands. This is an experimental
# feature meant to show how to start creating a "built-in" micro http server
# in the daemon.
#----------------------------------------------------------------------------
enable_webinterface=no

#----------------------------------------------------------------------------
# MAX_CLIENTS integer
# The maximum number of simultaneous clients that are allowed to connect
# to this server.
#----------------------------------------------------------------------------
max_clients=2

#----------------------------------------------------------------------------
# DATADIR string
# Base directory. The default file structure under the base directory is
# defined as
#
# datadir
# |-- mp2                           // Saved original MP2 files
# |-- mp4                           // Contains a subfolder for each
# |   |-- high                      // defined transcoding profile
# |   |-- low
# |   |-- mobile
# |   |-- normal
# |   `-- wnormal
# |-- stats                         // Contains a stats file for each
# |   |-- high.stats                // defined profile
# |   |-- low.stats
# |   |-- mobile.stats
# |   |-- normal.stats
# |   `-- wnormal.stats
# |-- vtmp                          // Contains a subdirectory for each
# |   |-- vid0                      // available video card
# |   `-- vid1
# `-- xmldb
#     `-- tvpvrd_db.xml             // The XML DB of all recording
#
# Legend:
# 
# mp2   - The original mp2 encoded files from the video cards
# vtmp  - Temporary files created during recording and transcoding
# mp4   - The transcoded mp4 files per defined profile
# xmldb - The XML DB file (+backups) are stored in this directory
# stats - Transcoding statistics
#
#----------------------------------------------------------------------------
datadir=/data/pvr/

#----------------------------------------------------------------------------
# TRANSCODING_TMPDIR string
# Temporary directory used when transcoding files. When the the server
# is running as a client it is useful to have this point to a local
# directory on the server and not the shared data directory pointed
# to by 'datadir' to avoid unnecessary network traffic
#----------------------------------------------------------------------------
transcoding_tmpdir=/data/pvr/vtmp

#----------------------------------------------------------------------------
# USE_PROFILE_DIECTORIES string
# Should we create and use a directory hierarchy based on the profile
# names to store the video files (and the transcoded files) under the
# basename "mp2/" and "mp4/". This can be usefull if you regularly
# use multiple transcodings for the same video for display on different
# devices. The hierarchy will make it easier to structure the recordings.
#----------------------------------------------------------------------------
use_profile_directories=no

#----------------------------------------------------------------------------
# LOGFILE_NAME string
# Name of logfile to use. The name can also be one of two special values
# 1) "syslog" - Use system logger
# 2) "stdout" - Use stdout - this is not valid if tvpvrd is run as a daemon 
#----------------------------------------------------------------------------
logfile_name=/tmp/tvpvrd.log

#----------------------------------------------------------------------------
# VERBOSE_LOG integer
# Setting verbose to 0 will only show error messages
# Setting verbose to 1 will also show info messages
# Setting verbose to 2 will also show info messages + notices
# Setting verbose to 3 will also show info messages + notices + debug messages
#----------------------------------------------------------------------------
verbose_log=1

#----------------------------------------------------------------------------
# SENDMAIL_ON_TRANSCODE_END boolean
# Send a mail notification whenever a transcoding have finished
#----------------------------------------------------------------------------
sendmail_on_transcode_end=no

#----------------------------------------------------------------------------
# SENDMAIL_ON_ERROR boolean
# Determine if all sever error messages also should be sent to a specified
# mail address (see sendmail_address)
#----------------------------------------------------------------------------
sendmail_on_error=no

#----------------------------------------------------------------------------
# SENDMAIL_ADDRESS string
# Mail address to use when sending notification of errors and transcode finished
#----------------------------------------------------------------------------
sendmail_address=root@localhost

#----------------------------------------------------------------------------
# DAEMONIZE bool
# Determine if we should disconnect from the controlling terminal i.e.
# become a daemon process.
#----------------------------------------------------------------------------
daemonize=yes

#----------------------------------------------------------------------------
# USERNAME string
# What user should the server be running under in case it is started
# as a daemon by root. For security reason the server should not be running
# as the root user.
# Note: The user must exist in the system and be a member of the video
# group since this is normally required to access the video device.
# To create a new (system) user, (i.e. a user without a login shell)
# the following command can be used
# $>adduser --system -G video tvpvrd
# The new user will belong to the default primary group, normally "users"
#----------------------------------------------------------------------------
username=tvpvrd

#----------------------------------------------------------------------------
# MAX_VIDEO integer
# The number of video cards that can be used  by the server.
# This is usually the same as the number of TV-Cards available. The number
# can never be higher than the number of physically available coders but it
# can be less to tell the server to only use some of the available coders.
# The program will also validate the available cards. If the number here
# is higher than the number of found cards in the system the server will
# given an error during startup and then terminate.
# If the number is set to 0 then the server will automatically determine
# the maximum number of cards and use all.
#----------------------------------------------------------------------------
max_video=0

#----------------------------------------------------------------------------
# REQUIRE_PASSWORD boolean
# Should a password be required to login to server
#----------------------------------------------------------------------------
require_password=no

#----------------------------------------------------------------------------
# PASSWORD string
# Password needed to connect to the server
#----------------------------------------------------------------------------
password=xxxxx

#----------------------------------------------------------------------------
# FREQUENCY_MAP string
# Specify what geographic frequency map should be used. Possible options are
# "europe-west"
# "europe-east"
# "france"
# "ireland"
# "italy"
# "australia"
# "newzealand"
# "us-bcast"
# "us-cable"
#----------------------------------------------------------------------------
frequency_map=europe-west

#----------------------------------------------------------------------------
# XMLDBFILE_NAME string 
# Name of file where the XML database of recordings are stored.
# Note that it will always be stored under the "xmldb" directory.
#----------------------------------------------------------------------------
xmldbfile_name=tvpvrd_db.xml

#----------------------------------------------------------------------------
# TIME_RESOLUTION integer
# How often do we check when to start a recording (in seconds)
#----------------------------------------------------------------------------
time_resolution=3

#----------------------------------------------------------------------------
# MAX_ENTRIES integer
# Maximum number of pending recordings per video stream.
#----------------------------------------------------------------------------
max_entries=1024

#----------------------------------------------------------------------------
# VIDEO_DEVICE_BASENAME string
# Basename for video device. This is almost without exception /dev/video
# Each tuner will then be access as /dev/video0, /dev/video1 etc.
# There is no limit to the number of supported capture cards.
#----------------------------------------------------------------------------
video_device_basename=/dev/video

#----------------------------------------------------------------------------
# ALLOW_PROFILES_ADJ_ENCODER boolean
# Normally each profile will adjust both the parameters on the capture
# card as well as the transcoding (ffmpeg) parameters. However, it seems
# that some capture card/driver combinations doesn't really like to have
# there HW settings (apart from tuner freq) adjusted too often. The
# indications of this is often that the driver temporarily lock up and
# that the card does not produce any MPEG data. This seems to happent more
# when there are many short recordings. Setting this parameter to "no"
# will cause the profiles to not be allowed to adjust the HW paramaters.
# Instead the HW parameters will be set in the startup of the server to
# the HW encoder parameters in the default profile, normally "normal". 
#----------------------------------------------------------------------------
allow_profiles_adj_encoder=yes

#----------------------------------------------------------------------------
# FNAME_SEPARATOR string
# File name separator to use when mangling filename for recurrent recordings
#----------------------------------------------------------------------------
fname_separator=_

#----------------------------------------------------------------------------
# CLIENT_IDLE_TIME integer
# Max idle time in seconds before clients are automatically disconnected
#----------------------------------------------------------------------------
client_idle_time=1800

#----------------------------------------------------------------------------
# RECORDING_TIMEHOUR integer
# RECORDING_TIMEMIN integer
# Default recording time (hour and minutes) if not specified otherwise
#----------------------------------------------------------------------------
recording_timehour=0
recording_timemin=59

#----------------------------------------------------------------------------
# XAWTV_STATION_FILE string
# The station file is a mapping between the official named
# frequncy channels and the common name of the stations. When
# specifying a frequency it is much easier to use, for example,
# "BBC1" than the official channel name e.g. "SE13".
# This file is in the same format as the
# xawtv station file so if you already have such a station file
# it can be reused here as well.
#----------------------------------------------------------------------------
xawtv_station_file=/etc/X11/xawtvrc

#----------------------------------------------------------------------------
# LOCALE_NAME string
# Specify the locale that should be used when running the daemon. If the
# daemon is started from a boot script (the normal) then this will most
# likely set the locale to "POSIX" which doesn't allow UTF8 characters.
# This can cause problem when sending mail from the daemon in case the
# recorded titles have UTF8 extended characters.
# Most modern system uses UTF8 as default. If unsure run "locale" from your
# console and use the value listed for LC_CTYPE or LC_ALL in this setting.
# Run "locale -a" to see a list of supported locales on your server.
#----------------------------------------------------------------------------
locale_name=en_US.UTF8

############################################################################
# ffmpeg - General settings for transcoding
############################################################################

[ffmpeg]

#----------------------------------------------------------------------------
# FFMPEG_BIN
# Command to execute ffmpeg
#----------------------------------------------------------------------------
ffmpeg_bin=/usr/bin/ffmpeg

#----------------------------------------------------------------------------
# MAX_LOAD_FOR_TRANSCODING
# The maximum load on the server allowed in order to start a transcoding
# Must be a value in range [1,10].
# The maximum setting for this should <= 2*<number of CPU cores> in server.
# There is really no point in setting this too high since transcoding
# is *very* CPU intensive and there is negative impact of multitasking too
# many transcoding jobs at once.
#----------------------------------------------------------------------------
max_load_for_transcoding=4

#----------------------------------------------------------------------------
# MAX_WAITING_TIME_TO_TRANSCODE
# The maximum time in seconds we will be waiting for the server load to fall
# below max_load_for_transcoding. Default is 12h = 12*3600 = 43200.
# If the maximum time is exceeded no transcoding will take place.
# If the time is specified as 0 then the daemon will wait forever
#----------------------------------------------------------------------------
max_waiting_time_to_transcode=43200

#----------------------------------------------------------------------------
# DEFAULT_TRANSCODING_PROFIL
# The profile that all new recodings will use as primary profile
#----------------------------------------------------------------------------
default_transcoding_profile=normal


# EOF - End of ini file
